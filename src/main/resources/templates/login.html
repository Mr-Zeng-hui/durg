<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>后台登录</title>
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="format-detection" content="telephone=no">
	<!-- load css -->
	<link rel="stylesheet" type="text/css" href="layui/css/layui.css" media="all">
	<link rel="stylesheet" type="text/css" href="css/login.css" media="all">
</head>
<body>
<div class="layui-canvs"></div>
<div class="layui-layout layui-layout-login" id="particles-js">
	<h1>
		<strong>药品查询系统</strong>
	</h1>
	<div class="layui-user-icon larry-login">
		<input type="text" placeholder="邮箱账号" id="email_acc" name="email_acc" class="login_txtbx"/>
	</div>
	<div class="layui-pwd-icon larry-login">
		<input type="password" id="email_pass" name="email_pass" placeholder="密码" class="login_txtbx"/>
	</div>
	<div class="layui-val-icon larry-login">
		<div class="layui-code-box">
			<input type="text" id="code" name="code" placeholder="验证码" maxlength="8" class="login_txtbx">
			<input type="button" name="verifyCode" class="layui-btn layui-bg-orange verifyImg" value="获取验证码"  id="verifyCode" onclick="sendSms()">
		</div>
	</div>
	<div class="layui-submit larry-login" style="margin-top: 5%">
		<input type="button" value="登陆" class="submit_btn" onclick="submit()"/>
	</div>
	<div class="layui-submit larry-login" style="margin-top: 5%">
		<input type="button" value="免费注册" class="layui-btn-xs" style="float: right;"/>
		<input type="button" value="重置密码" class="layui-btn-xs" style="float: left;"/>
	</div>
</div>
<script type="text/javascript" src="layui/lay/dest/layui.all.js"></script>
<script type="text/javascript" src="js/login.js"></script>
<script type="text/javascript" src="js/jparticle.jquery.js"></script>
<script type="text/javascript">
	$(function(){
		$(".layui-canvs").jParticle({
			background: "#f5f5f5",
			color: "#E6E6E6",
			backgroundImage: "static/img/bg.jpg"
		});

		//登录链接测试，使用时可删除
		$(".submit_btn").click(function(){
			location.href="index.html";
		});
	});

	sendSms = function(){
		debugger;
		var email = $("#email_acc").val();
		if (!email){
			layer.msg('请输入邮箱！', {icon: 2,time: 1000});
			return;
		}
		$.ajax({
			dataType:'application/json',
			url:'/email/send',
			data:{to:email},
			type:'post',
			success:function(result){
				if (result.code == 200){
					layer.msg('发送成功！', {icon: 1,time: 2000});
					$("#verifyCode").addcss("layui-btn-disabled");
					setTimeout(function(){
						$("#verifyCode").removecss("layui-btn-disabled");
					},30*1000);
				}else{
					layer.msg(result.msg, {icon: 1,time: 2000});
				}

				//$(".layui-main").html(result);
			},beforeSend:function(){
			//	$(".layui-main").empty();
			//	layer.load(1);
			},complete:function(){
				//layer.closeAll('loading');
			}
		});

	}

	submit = function(){
		var email = $("#email_acc").val();
		if (!email){
			layer.msg('请输入邮箱！', {icon: 2,time: 1000});
			return;
		}
		var password = $("#email_pass").val();
		if (!password){
			layer.msg('请输入密码！', {icon: 2,time: 1000});
			return;
		}
		var verifyCode = $("#verifyCode").val();
		$.ajax({
			dataType:'application/json',
			url:'/admin/login',
			data:{username:email,password:password,verifyCode:verifyCode},
			type:'post',
			success:function(result){
				if (result.code == 200){
					layer.msg('登录成功！', {icon: 1,time: 2000});
					location.href="/index";
				}else{
					layer.msg(result.msg, {icon: 2,time: 2000});
				}
			}
		});


	}

</script>
</body>
</html>
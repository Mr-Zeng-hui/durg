<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Demo</title>
    <link href="https://www.layuicdn.com/layui/css/layui.css" rel="stylesheet">
    <script src="https://www.layuicdn.com/layui/layui.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <style>
        .layui-table-img {
            width: 50px;  /* 设置图片宽度 */
            height: 50px; /* 设置图片高度 */
        }

    </style>
</head>
<body>
<form  autocomplete="off" onsubmit="return false;" class="form-inline" id="batchMgrForm">
    <div class="layui-card" style="margin-bottom: 0px;">
        <div class="layui-card-body">
        </div>
    </div>
    <div class="layui-card" style="margin-top: 1px;border-bottom:1px solid #ccc;">
        <div class="layui-card-body">
            <div class="layui-row">

                <div class="layui-form-item" >
                    <div style="width: 50%;float: left;">
                        <label class="layui-form-label">主治症状</label>
                        <div class="layui-input-block" >
                            <input type="text" name="bak" id="bak"  placeholder="请输入" autocomplete="off" class="layui-input">

                        </div>
                    </div>
                    <button type="button" class="layui-btn " style="margin-left: 10px;" onclick="query()"> 搜索</button>
                </div>


                <table class="layui-hide" id="list"></table>
            </div>
        </div>
    </div>


</form>



<script>
    layui.use('table', function(){
        var table = layui.table;
        // 已知数据渲染
        var inst = table.render({
            elem: '#list',
            cols: [
                [ //标题栏
                    {field: 'id', title: 'ID', width: 150},
                    {field: 'name', title: '药品名称', width: 150},
                    // {field: 'bigname', title: '详细名称', width: 100},
                    {field: 'bak', title: '主治症状', width: 180},
                    {field:'img1', title:'百度健康药品图片', width:200, templet: function(d){
                            if(d.img1){
                                return '<img src="'+ d.img1 +'" class="layui-table-img"/>';
                            }else{
                                return ''
                            }
                        }},
                    {field: 'price1', title: '百度健康价格', width: 150},
                    {field:'img2', title:'阿里大药房药品图片', width:200, templet: function(d){
                            if(d.img2){
                                return '<img src="'+ d.img2 +'" class="layui-table-img"/>';
                            }else{
                                return ''
                            }
                        }},
                    {field: 'price2', title: '阿里大药房价格', width: 150},
                    {field: 'instructions', title: '说明书'},
                    {field:'OPER', title: '操作',fixed:'right',align:'center',width: 80, templet : function(row){
                            var temp="";
                            temp+= ' <span href="javascript:void(0)" class="layui-btn layui-btn-xs layui-btn-warn" onclick="runPython(\''+row.id+'\', \''+row.name+'\')">爬取最新</span> ';
                            return temp;
                        }}
                ]
            ],
            url: '/drug/drugInfo/data',  // 后端接口地址
            // data: [
            //     { // 赋值已知数据
            //     "id": "10001",
            //     "username": "布洛芬缓释胶囊",
            //     "sex": "布洛芬",
            //     "city": "19.9",
            //     "sign": "布洛芬（Ibuprofen）为解热镇痛类，非甾体抗炎药。本品通过抑制环氧化酶，减少前列腺素的合成，产生镇痛、抗炎作用；通过下丘脑体温调节中枢而起解热作用。",
            //     "experience": "218"
            // }, {
            //     "id": "10002",
            //     "username": "布洛芬缓释胶囊",
            //     "sex": "布洛芬",
            //     "city": "19.9",
            //     "sign": "布洛芬（Ibuprofen）为解热镇痛类，非甾体抗炎药。本品通过抑制环氧化酶，减少前列腺素的合成，产生镇痛、抗炎作用；通过下丘脑体温调节中枢而起解热作用。",
            //     "experience": "218"
            // }, {
            //     "id": "10003",
            //     "username": "布洛芬缓释胶囊",
            //     "sex": "布洛芬",
            //     "city": "19.9",
            //     "sign": "布洛芬（Ibuprofen）为解热镇痛类，非甾体抗炎药。本品通过抑制环氧化酶，减少前列腺素的合成，产生镇痛、抗炎作用；通过下丘脑体温调节中枢而起解热作用。",
            //     "experience": "218"
            // }, {
            //     "id": "10004",
            //     "username": "布洛芬缓释胶囊",
            //     "sex": "布洛芬",
            //     "city": "19.9",
            //     "sign": "布洛芬（Ibuprofen）为解热镇痛类，非甾体抗炎药。本品通过抑制环氧化酶，减少前列腺素的合成，产生镇痛、抗炎作用；通过下丘脑体温调节中枢而起解热作用。",
            //     "experience": "218"
            // }, {
            //     "id": "10005",
            //     "username": "布洛芬缓释胶囊",
            //     "sex": "布洛芬",
            //     "city": "19.9",
            //     "sign": "布洛芬（Ibuprofen）为解热镇痛类，非甾体抗炎药。本品通过抑制环氧化酶，减少前列腺素的合成，产生镇痛、抗炎作用；通过下丘脑体温调节中枢而起解热作用。",
            //     "experience": "218"
            // }, {
            //     "id": "10006",
            //     "username": "布洛芬缓释胶囊",
            //     "sex": "布洛芬",
            //     "city": "19.9",
            //     "sign": "布洛芬（Ibuprofen）为解热镇痛类，非甾体抗炎药。本品通过抑制环氧化酶，减少前列腺素的合成，产生镇痛、抗炎作用；通过下丘脑体温调节中枢而起解热作用。",
            //     "experience": "218"
            // }, {
            //     "id": "10007",
            //     "username": "布洛芬缓释胶囊",
            //     "sex": "布洛芬",
            //     "city": "19.9",
            //     "sign": "布洛芬（Ibuprofen）为解热镇痛类，非甾体抗炎药。本品通过抑制环氧化酶，减少前列腺素的合成，产生镇痛、抗炎作用；通过下丘脑体温调节中枢而起解热作用。",
            //     "experience": "218"
            // }, {
            //     "id": "10008",
            //     "username": "布洛芬缓释胶囊",
            //     "sex": "布洛芬",
            //     "city": "19.9",
            //     "sign": "布洛芬（Ibuprofen）为解热镇痛类，非甾体抗炎药。本品通过抑制环氧化酶，减少前列腺素的合成，产生镇痛、抗炎作用；通过下丘脑体温调节中枢而起解热作用。",
            //     "experience": "218"
            // }
            // ],
            //skin: 'line', // 表格风格
            //even: true,
            page: true, // 是否显示分页
            limits: [50, 100],
            height: 'full-160'
        });






    });
    // 模拟一个接口调用成功后刷新表格的操作
    function refreshTable() {
        // 在实际场景中，你需要调用你的接口，然后在接口回调中执行下面的代码
        // 调用 table.reload 方法刷新表格
        layui.table.reload('list'); // test 为表格 lay-filter 的值，需要与 table.render 中的 lay-filter 一致
    }

    function query() {
        refreshTable();
    }

    function runPython(id, keyword){
        $.ajax({
            url : '/drug/drugInfo/crawlingData?id='+id+'&keyword='+keyword,
            type : 'get',
            success : function(result) {
                refreshTable();
            },error : function(jqXHR, textStatus, errorThrown) {
                layer.alert("出现网络故障,请稍后再试!",{icon:7,time:15000});
            }
        });
    }

</script>

</body>
</html>